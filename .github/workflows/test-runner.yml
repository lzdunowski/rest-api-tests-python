name: Test Runner

on:
    schedule:
        - cron: '*/2 * * * *'
    workflow_dispatch:
        inputs:
            python_version:
                description: 'Python version'
                required: true
                default: '3.13.2'
    push:
    pull_request:

jobs:
    Run-Tests:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Python ${{ github.event.inputs.python_version }}
              uses: actions/setup-python@v3
              with:
                python-version: ${{ github.event.inputs.python_version }}

            - name: Install dependencies
              run: |
                    chmod +x -R ${{ github.workspace }}
                    python3 -m pip install --upgrade pip
                    python3 -m pip install -r requirements.txt
                    export PYTHONPATH="${PYTHONPATH}:${{github.workspace}}"
                    echo "PYTHONPATH=${PYTHONPATH}"

            - name: Run tests
              run: python3 -m pytest -s tests/part_01/test_users.py --junitxml=tests/results.xml --html=tests/results.html
            - name: Create test summary

              uses: test-summary/action@dist
              if: success() || failure()
              with:
                paths: tests/results.xml

            - name: Upload test results
              uses: actions/upload-artifact@v4
              if: success() || failure()
              with:
                name: test-results
                path: |
                    tests/results.xml
                    tests/results.html
                    assets
